<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Accesso riservato alla piattaforma SCAN360 per l'analisi finanziaria di EDILCALCESTRUZZO SRL">
    <title>Login - SCAN360 | EDILCALCESTRUZZO SRL</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <style>
        /* Stili aggiuntivi specifici per login */
        html, body { height: 100%; }
        body { 
            display: flex; 
            align-items: center; 
            padding-top: 40px; 
            padding-bottom: 40px; 
            background-color: #eef2f7; 
            background-image: linear-gradient(135deg, #eef2f7 0%, #e6edf5 100%);
        }
        .login-container { 
            max-width: 450px; 
            margin: auto; 
            width: 90%;
        }
        .login-card-header { 
            background-color: var(--primary, #1a1a5e); 
            color: white; 
            border-radius: 8px 8px 0 0 !important; 
            padding: 1rem 1.5rem; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .login-btn { 
            background-color: var(--primary, #1a1a5e); 
            border-color: var(--primary, #1a1a5e); 
            padding: 0.75rem 1.5rem; 
            font-weight: 600; 
            color: white !important;
            transition: all 0.3s ease;
        }
        .login-btn:hover { 
            background-color: #13134f; 
            border-color: #13134f; 
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .login-btn:active {
            transform: translateY(0);
        }
        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .powered-by img { 
            max-height: 25px; 
            filter: grayscale(50%);
            transition: filter 0.3s ease;
        }
        .powered-by:hover img {
            filter: grayscale(0%);
        }
        .watermark-login { 
            text-align: center; 
            margin-top: 20px; 
            color: #6c757d; 
            font-size: 0.8rem; 
        }
        .input-group-text {
            background-color: #f8f9fa;
            border-right: none;
        }
        .form-control {
            border-left: none;
        }
        .form-control:focus {
            box-shadow: none;
            border-color: #ced4da;
            border-left: none;
        }
        .input-group:focus-within .input-group-text {
            border-color: #86b7fe;
        }
        .alert-login {
            display: none;
            margin-bottom: 1rem;
        }
        .card {
            border: none;
            border-radius: 8px;
        }
        .logo-container {
            margin-bottom: 1.5rem;
        }
        .logo-container img {
            max-height: 50px;
        }
        #error-message {
            display: none;
        }
    </style>
</head>
<body>
    <div class="login-container w-100">
        <div class="card shadow-lg">
            <div class="card-header text-center login-card-header">
                <h4 class="mb-0">SCAN360</h4>
                <small>Strategic Corporate Analysis Navigator</small>
            </div>
            <div class="card-body p-4 p-md-5">
                <div class="text-center mb-4">
                    <div class="logo-container">
                        <!-- Logo placeholder -->
                    </div>
                    <h5 class="fw-bold">Accesso Riservato</h5>
                    <p class="text-muted small mb-0">Analisi Finanziaria EDILCALCESTRUZZO SRL</p>
                    <p class="text-muted small">Estrazione di ghiaia, sabbia, argilla e caolino</p>
                </div>
                
                <!-- Messaggio di errore -->
                <div class="alert alert-danger alert-login" id="error-message" role="alert">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <span id="error-message-text">Credenziali non valide. Riprova.</span>
                </div>
                
                <form id="loginForm">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                            <input 
                                type="text" 
                                class="form-control" 
                                id="username" 
                                name="username"
                                placeholder="Inserisci username" 
                                required 
                                autocomplete="username"
                            >
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="password" class="form-label">Password</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-lock"></i></span>
                            <input 
                                type="password" 
                                class="form-control" 
                                id="password" 
                                name="password"
                                placeholder="Inserisci password" 
                                required 
                                autocomplete="current-password"
                            >
                            <button class="btn btn-outline-secondary" type="button" id="togglePassword" tabindex="-1">
                                <i class="far fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="d-grid mt-4">
                        <button type="submit" class="btn login-btn" id="loginButton">
                            <span id="loginBtnText">Accedi</span>
                            <i class="fas fa-sign-in-alt ms-1" id="loginIcon"></i>
                            <span class="spinner-border spinner-border-sm ms-1 d-none" id="loginSpinner" role="status" aria-hidden="true"></span>
                        </button>
                    </div>
                </form>
                
                <div class="powered-by d-flex justify-content-center align-items-center mt-4 pt-3 border-top">
                    <span class="text-muted small">Powered by <a href="https://www.kitzanos.com" target="_blank" rel="noopener noreferrer" class="text-decoration-none fw-semibold text-primary">Kitzanos Lab</a></span>
                </div>
            </div>
        </div>
        <div class="watermark-login">
            SCAN360 Â© 2025 Kitzanos Lab | Report elaborato il 11/08/2025
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- IMPORTANTE: Prima carichiamo common.js con le funzioni di login -->
    <script src="js/common.js"></script>
    
    <!-- Script aggiuntivo per questa pagina -->
    <script>
        // Toggle password visibility
        document.getElementById('togglePassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('password');
            const icon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });
        
        // Override della funzione handleLogin per aggiungere animazioni
        const originalHandleLogin = window.handleLogin;
        
        window.handleLogin = function(event) {
            if (event) event.preventDefault();
            
            const loginButton = document.getElementById('loginButton');
            const loginBtnText = document.getElementById('loginBtnText');
            const loginSpinner = document.getElementById('loginSpinner');
            const loginIcon = document.getElementById('loginIcon');
            const errorDiv = document.getElementById('error-message');
            
            // Mostra spinner
            loginButton.disabled = true;
            loginBtnText.textContent = 'Accesso in corso';
            loginSpinner.classList.remove('d-none');
            loginIcon.classList.add('d-none');
            
            // Nascondi messaggi di errore precedenti
            errorDiv.style.display = 'none';
            
            // Simula un piccolo delay per l'effetto visivo
            setTimeout(() => {
                // Chiama la funzione originale dal common.js
                const result = originalHandleLogin.call(this, event);
                
                // Se il login fallisce, ripristina il pulsante
                setTimeout(() => {
                    const isLoggedIn = localStorage.getItem('scanUserLoggedIn') === 'true';
                    if (!isLoggedIn) {
                        loginButton.disabled = false;
                        loginBtnText.textContent = 'Accedi';
                        loginSpinner.classList.add('d-none');
                        loginIcon.classList.remove('d-none');
                        
                        // Mostra messaggio di errore
                        errorDiv.style.display = 'block';
                        document.getElementById('error-message-text').textContent = 'Credenziali non valide. Riprova.';
                        
                        // Focus sul campo username
                        document.getElementById('username').focus();
                        document.getElementById('username').select();
                    }
                }, 500);
                
                return result;
            }, 300);
            
            return false;
        };
        
        // Se handleLogin non esiste in common.js, usa questa versione locale
        if (typeof window.handleLogin === 'undefined') {
            window.handleLogin = function(event) {
                if (event) event.preventDefault();
                
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;
                const loginButton = document.getElementById('loginButton');
                const loginBtnText = document.getElementById('loginBtnText');
                const loginSpinner = document.getElementById('loginSpinner');
                const loginIcon = document.getElementById('loginIcon');
                const errorDiv = document.getElementById('error-message');
                
                // Mostra spinner
                loginButton.disabled = true;
                loginBtnText.textContent = 'Accesso in corso';
                loginSpinner.classList.remove('d-none');
                loginIcon.classList.add('d-none');
                
                // Nascondi errori precedenti
                errorDiv.style.display = 'none';
                
                setTimeout(() => {
                    // Validazione credenziali
                    if (username === 'Admin' && password === 'Edilcalcestruzzo2025') {
                        // Salva stato login
                        try {
                            localStorage.setItem('scanUserLoggedIn', 'true');
                            localStorage.setItem('scanUsername', username);
                            localStorage.setItem('scanLoginTime', new Date().toISOString());
                            
                            // Reindirizza
                            window.location.href = 'index.html';
                        } catch (e) {
                            console.error('Errore storage:', e);
                            errorDiv.style.display = 'block';
                            document.getElementById('error-message-text').textContent = 'Errore di sistema. Riprova.';
                        }
                    } else {
                        // Login fallito
                        loginButton.disabled = false;
                        loginBtnText.textContent = 'Accedi';
                        loginSpinner.classList.add('d-none');
                        loginIcon.classList.remove('d-none');
                        
                        errorDiv.style.display = 'block';
                        document.getElementById('error-message-text').textContent = 'Credenziali non valide. Riprova.';
                        
                        // Pulisci password
                        document.getElementById('password').value = '';
                        document.getElementById('username').focus();
                        document.getElementById('username').select();
                    }
                }, 500);
                
                return false;
            };
        }
        
        // Aggiungi listener al form
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
        
        // Focus automatico sul campo username
        window.addEventListener('load', function() {
            document.getElementById('username').focus();
        });
    </script>
    
    <!-- Altri script opzionali -->
    <!-- <scan-chat data-bot-id="033a9b91-a72b-4704-aae2-04d0b1796bdd"></scan-chat> -->
    <!-- <script src="./js/bundle.js"></script> -->
</body>
</html>
